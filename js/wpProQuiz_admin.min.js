jQuery(document).ready(function(a){a.fn.wpProQuiz_preview=function(){var b={openPreview:function(b){window.open(a(b).attr("href"),"wpProQuizPreview","width=900,height=900")}};a(".wpProQuiz_prview").click(function(a){b.openPreview(this);a.preventDefault()})};a.fn.wpProQuiz_quizOverall=function(){var b={changeExport:function(b){$input=a(b);$export=a(".wpProQuiz_exportList");$ul=$export.find("ul").first();$export.find("li").remove();a('input[name="exportItems"]').each(function(){$this=a(this);if(this.checked){var d=
$this.parent().parent().find(".wpProQuiz_quizName a:eq(0)").text();a("<li>"+d+"</li>").appendTo($ul)}})},startExport:function(){$ele=a('input[name="exportItems"]:checked');if(1>$ele.length)return alert(wpProQuizLocalize.no_selected_quiz),!1;$hidden=a("#exportHidden");$hidden.html("");a('input[name="exportItems"]').each(function(){$this=a(this);this.checked&&a('<input type="hidden" value="'+this.value+'" name="exportIds[]">').appendTo($hidden)});return!0}};a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?
(a.preventDefault(),!1):!0});a(".wpProQuiz_import").click(function(b){b.preventDefault();a(".wpProQuiz_importList").toggle("fast");a(".wpProQuiz_exportList").hide();a(".wpProQuiz_exportCheck").hide()});a(".wpProQuiz_export").click(function(b){b.preventDefault();a(".wpProQuiz_exportList").toggle("fast");a(".wpProQuiz_exportCheck").toggle("fast");a(".wpProQuiz_importList").hide()});a('input[name="exportItems"]').change(function(){b.changeExport(this)});a('input[name="exportItemsAll"]').change(function(){var b=
a('input[name="exportItems"]');this.checked?b.attr("checked",!0):b.attr("checked",!1);b.change()});a("#exportStart").click(function(a){b.startExport()||a.preventDefault()})};a.fn.wpProQuiz_questionOverall=function(){var b={saveSort:function(){var h={action:"wp_pro_quiz_update_sort",sort:b.parseSortArray()},d=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=save_sort";a.post(d,h,function(){a("#sortMsg").show(400).delay(1E3).hide(400)})},parseSortArray:function(){var b=
[];a("tbody tr").each(function(){b.push(this.id.replace("wpProQuiz_questionId_",""))});return b},sortUpdate:function(){a(".wpProQuiz_questionOverall tbody").children().each(function(){$t=a(this).children().first().text(a(this).index()+1)})},loadQuestionCopy:function(){var b=a("#questionCopySelect"),d=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_question";b.hide();b.empty();a("#loadDataImg").show();a.post(d,{action:"wp_pro_quiz_load_question",
excludeId:1},function(d){a.each(d,function(d,c){var g=a(document.createElement("optgroup"));g.attr("label",c.name);a.each(c.question,function(c,d){a(document.createElement("option")).val(d.id).text(d.name).appendTo(g)});b.append(g)});a("#loadDataImg").hide();b.show()},"json")}};a(".wp-list-table tbody").sortable({handle:".wpProQuiz_move",update:b.sortUpdate});a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?(a.preventDefault(),!1):!0});a("#wpProQuiz_saveSort").click(function(a){a.preventDefault();
b.saveSort()});a("#wpProQuiz_questionCopy").click(function(h){var d=a(".wpProQuiz_questionCopy");d.is(":visible")?d.hide():(d.show(),b.loadQuestionCopy());h.preventDefault()})};a.fn.wpProQuiz_quizEdit=function(){var b={addResult:function(){a("#resultList").children().each(function(){if("none"==a(this).css("display")){var d=a(this),b=d.find('textarea[name="resultTextGrade[text][]"]'),e=b.attr("id"),c=!0;d.find('input[name="resultTextGrade[prozent][]"]').val("0");d.find('input[name="resultTextGrade[activ][]"]').val("1").keyup();
void 0!=tinymce.editors[e]&&!tinymce.editors[e].isHidden()&&(c=!1);void 0!=switchEditors&&!c&&(switchEditors.go(e,"toggle"),switchEditors.go(e,"toggle"));void 0!=tinymce.editors[e]?tinymce.editors[e].setContent(""):b.val("");void 0!=tinymce.editors[e]&&!c&&tinyMCE.execCommand("mceRemoveControl",!1,e);d.parent().children(":visible").last().after(d);void 0!=tinymce.editors[e]&&!c&&tinyMCE.execCommand("mceAddControl",!1,e);a(this).show();void 0!=switchEditors&&!c&&switchEditors.go(e,"toggle");return!1}})},
deleteResult:function(d){a(d).parent().parent().hide();a(d).siblings('input[name="resultTextGrade[activ][]"]').val("0")},changeResult:function(d){d=a(d);if(b.validResultInput(d.val()))return d.siblings(".resultProzent").text(d.val()),d.removeAttr("style"),!0;d.css("background-color","#FF9696");return!1},validResultInput:function(a){if(h(a))return!1;a=a.replace(/\,/,".");return!isNaN(a)&&100>=Number(a)&&0<=Number(a)?null!=a.match(/\./)?3>a.split(".")[1].length:!0:!1},validInput:function(){if(h(a("#wpProQuiz_title").val()))return alert(wpProQuizLocalize.no_title_msg),
!1;var d="",d=void 0!=tinymce.editors.text&&!tinymce.editors.text.isHidden()?tinymce.editors.text.getContent():a('textarea[name="text"]').val();if(h(d))return alert(wpProQuizLocalize.no_quiz_start_msg),!1;if(a("#wpProQuiz_resultGradeEnabled:checked").length){var f=!0;a("#resultList").children().each(function(){if(a(this).is(":visible")&&!b.validResultInput(a(this).find('input[name="resultTextGrade[prozent][]"]').val()))return f=!1});if(!f)return alert(wpProQuizLocalize.fail_grade_result),!1}return!0},
resetLock:function(){var b=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php"),b=b.replace("action=edit","action=reset_lock");a.post(b,{action:"wp_pro_quiz_reset_lock"},function(){a("#resetLockMsg").show("fast").delay(2E3).hide("fast")})}},h=function(b){b=a.trim(b);return!b||0===b.length};a("#statistics_on").change(function(){this.checked?a("#statistics_ip_lock_tr").show():a("#statistics_ip_lock_tr").hide()});a(".addResult").click(function(){b.addResult()});a(".deleteResult").click(function(){b.deleteResult(this)});
a('input[name="resultTextGrade[prozent][]"]').keyup(function(){b.changeResult(this)}).keydown(function(a){13==a.which&&a.preventDefault()});a("#wpProQuiz_resultGradeEnabled").change(function(){this.checked?(a("#resultGrade").show(),a("#resultNormal").hide()):(a("#resultGrade").hide(),a("#resultNormal").show())});a("#wpProQuiz_save").click(function(d){b.validInput()||d.preventDefault();a('select[name="prerequisiteList[]"] option').attr("selected","selected")});a('input[name="quizRunOnce"]').change(function(){this.checked?
(a("#wpProQuiz_quiz_run_once_type").show(),a('input[name="quizRunOnceType"]:checked').change()):a("#wpProQuiz_quiz_run_once_type").hide()});a('input[name="quizRunOnceType"]').change(function(){this.checked&&("1"==this.value||"3"==this.value)?a("#wpProQuiz_quiz_run_once_cookie").show():a("#wpProQuiz_quiz_run_once_cookie").hide()});a('input[name="resetQuizLock"]').click(function(){b.resetLock();return!1});a(".wpProQuiz_demoBox a").mouseover(function(b){var f=a(this),e=a(document).width(),f=f.siblings().outerWidth(!0);
b.pageX+f>e&&(b=e-(b.pageX+f+30),a(this).next().css("left",b+"px"));a(this).next().show()}).mouseout(function(){a(this).next().hide()}).click(function(){return!1});a('input[name="showMaxQuestion"]').change(function(){this.checked?(a('input[name="statisticsOn"]').removeAttr("checked").attr("disabled","disabled").change(),a("#wpProQuiz_showMaxBox").show()):(a('input[name="statisticsOn"]').removeAttr("disabled"),a("#wpProQuiz_showMaxBox").hide())});a("#btnPrerequisiteAdd").click(function(){a('select[name="quizList"] option:selected').removeAttr("selected").appendTo('select[name="prerequisiteList[]"]')});
a("#btnPrerequisiteDelete").click(function(){a('select[name="prerequisiteList[]"] option:selected').removeAttr("selected").appendTo('select[name="quizList"]')});a('input[name="prerequisite"]').change(function(){this.checked?a("#prerequisiteBox").show():a("#prerequisiteBox").hide()}).change();a('input[name="toplistDataAddMultiple"]').change(function(){this.checked?a("#toplistDataAddBlockBox").show():a("#toplistDataAddBlockBox").hide()}).change();a('input[name="toplistActivated"]').change(function(){this.checked?
a("#toplistBox > tr:gt(0)").show():a("#toplistBox > tr:gt(0)").hide()}).change();a('input[name="showReviewQuestion"]').change(function(){this.checked?a(".wpProQuiz_reviewQuestionOptions").show():a(".wpProQuiz_reviewQuestionOptions").hide()}).change();a("#statistics_on").change();a("#wpProQuiz_resultGradeEnabled").change();a('input[name="quizRunOnce"]').change();a('input[name="quizRunOnceType"]:checked').change();a('input[name="showMaxQuestion"]').change()};a.fn.wpProQuiz_statistics=function(){var b=
"wpProQuiz_typeAnonymeUser",h=!0,d={loadStatistics:function(b){var e=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",b={action:"wp_pro_quiz_load_statistics",userId:b};a("#wpProQuiz_loadData").show();a("#wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a.post(e,b,d.setStatistics,"json")},setStatistics:function(d){var e=a(".wpProQuiz_statistics_table"),c=e.find("tbody");if("wpProQuiz_typeOverview"!=b){var g=function(a,
b,c){a.find(".wpProQuiz_cCorrect").text(b.cCorrect+" ("+b.pCorrect+"%)");a.find(".wpProQuiz_cIncorrect").text(b.cIncorrect+" ("+b.pIncorrect+"%)");a.find(".wpProQuiz_cTip").text(b.cTip);a.find(".wpProQuiz_cPoints").text(b.cPoints);!0==c&&e.find(".wpProQuiz_cResult").text(b.result+"%")};g(e,d.clear,!1);a.each(d.items,function(a,b){g(c.find("#wpProQuiz_tr_"+b.id),b,!1)});g(e.find("tfoot"),d.global,!0);a("#wpProQuiz_loadData").hide();a("#wpProQuiz_statistics_content, .wpProQuiz_statistics_table").show()}},
loadOverview:function(){a(".wpProQuiz_statistics_table, #wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a("#wpProQuiz_loadData").show();var f=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",e={action:"wp_pro_quiz_load_statistics",overview:!0,pageLimit:a("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(a("#wpProQuiz_onlyCompleted").is(":checked")),page:a("#wpProQuiz_currentPage").val(),generatePageNav:Number(h)};
a.post(f,e,function(c){a("#wpProQuiz_statistics_overview_data").empty();if("wpProQuiz_typeOverview"==b){var g=a('<tr><th><a href="#">---</a></th><th class="wpProQuiz_points">---</th><th class="wpProQuiz_cCorrect" style="color: green;">---</th><th class="wpProQuiz_cIncorrect" style="color: red;">---</th><th class="wpProQuiz_cTip">---</th><th class="wpProQuiz_cResult" style="font-weight: bold;">---</th></tr>');a.each(c.items,function(b,c){var d=g.clone();d.find("a").text(c.userName).data("userId",c.userId).click(function(){a("#userSelect").val(a(this).data("userId"));
a("#wpProQuiz_typeRegisteredUser").click();return!1});c.completed?(d.find(".wpProQuiz_points").text(c.cPoints),d.find(".wpProQuiz_cCorrect").text(c.cCorrect+" ("+c.pCorrect+"%)"),d.find(".wpProQuiz_cIncorrect").text(c.cIncorrect+" ("+c.pIncorrect+"%)"),d.find(".wpProQuiz_cTip").text(c.cTip),d.find(".wpProQuiz_cResult").text(c.result+"%")):d.find("th").removeAttr("style");a("#wpProQuiz_statistics_overview_data").append(d)});void 0!=c.page&&(d.setPageNav(c.page),h=!1);a("#wpProQuiz_loadData").hide();
a("#wpProQuiz_statistics_overview").show()}},"json")},changeTab:function(f){b=f;"wpProQuiz_typeRegisteredUser"==f?d.loadStatistics(a("#userSelect").val()):"wpProQuiz_typeAnonymeUser"==f?d.loadStatistics(0):d.loadOverview()},resetStatistic:function(f){var e="wpProQuiz_typeRegisteredUser"==b?a("#userSelect").val():0,c=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=reset";a.post(c,{action:"wp_pro_quiz_statistics",userId:e,complete:f},function(){d.changeTab(b)})},
setPageNav:function(b){b=Math.ceil(b/a("#wpProQuiz_pageLimit").val());a("#wpProQuiz_currentPage").empty();for(var d=1;d<=b;d++)a(document.createElement("option")).val(d).text(d).appendTo(a("#wpProQuiz_currentPage"));a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1<a("#wpProQuiz_currentPage option").length&&a("#wpProQuiz_pageRight").show()}};a(".wpProQuiz_tab").click(function(){var b=a(this);if(b.hasClass("button-primary"))return!1;"wpProQuiz_typeRegisteredUser"==b.attr("id")?a("#wpProQuiz_userBox").show():
a("#wpProQuiz_userBox").hide();a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");b.removeClass("button-secondary").addClass("button-primary");d.changeTab(b.attr("id"));return!1});a("#userSelect").change(function(){d.changeTab("wpProQuiz_typeRegisteredUser")});a(".wpProQuiz_update").click(function(){d.changeTab(b);return!1});a("#wpProQuiz_reset").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&d.resetStatistic(!1);return!1});a(".wpProQuiz_resetComplete").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&
d.resetStatistic(!0);return!1});a("#wpProQuiz_pageLimit, #wpProQuiz_onlyCompleted").change(function(){a("#wpProQuiz_currentPage").val(0);h=!0;d.changeTab(b);return!1});a("#wpProQuiz_currentPage").change(function(){a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1!=a("#wpProQuiz_currentPage option").length&&(a("#wpProQuiz_currentPage option:first-child:selected").length?a("#wpProQuiz_pageRight").show():a("#wpProQuiz_currentPage option:last-child:selected").length?a("#wpProQuiz_pageLeft").show():
a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").show());d.changeTab(b)});a("#wpProQuiz_pageRight").click(function(){a("#wpProQuiz_currentPage option:selected").next().attr("selected","selected");a("#wpProQuiz_currentPage").change();return!1});a("#wpProQuiz_pageLeft").click(function(){a("#wpProQuiz_currentPage option:selected").prev().attr("selected","selected");a("#wpProQuiz_currentPage").change();return!1});d.changeTab("wpProQuiz_typeAnonymeUser")};a.fn.wpProQuiz_toplist=function(){var b=a("#wpProQuiz_sorting"),
h=a("#wpProQuiz_pageLimit"),d=a("#wpProQuiz_currentPage"),f=a("#wpProQuiz_loadData"),e=a("#wpProQuiz_pageLeft"),c=a("#wpProQuiz_pageRight"),g=a("#wpProQuiz_toplistTable tbody"),p=a("#wpProQuiz_toplistTable tbody tr:eq(0)").clone(),l=a("#wpProQuiz_content"),i={loadData:function(c){var k=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_toplist",m=this,n={action:"wp_pro_quiz_load_toplist",sort:b.val(),limit:h.val(),page:d.val()};void 0!=c&&a.extend(n,
c);f.show();l.hide();a.post(k,n,function(a){m.handleDataRequest(a.data);void 0!=a.nav&&m.handleNav(a.nav);f.hide();l.show()},"json")},handleNav:function(b){d.empty();for(var c=1;c<=b.pages;c++)a(document.createElement("option")).val(c).text(c).appendTo(d);this.checkNav()},handleDataRequest:function(b){var c=this;g.empty();a.each(b,function(a,b){var c=p.clone().children();c.eq(0).children().val(b.id);c.eq(1).find("strong").text(b.name);c.eq(1).find(".inline_editUsername").val(b.name);c.eq(2).find(".wpProQuiz_email").text(b.email);
c.eq(2).find("input").val(b.email);c.eq(3).text(b.type);c.eq(4).text(b.date);c.eq(5).text(b.points);c.eq(6).text(b.result);c.parent().show().appendTo(g)});b.length||a(document.createElement("td")).attr("colspan","7").text(wpProQuizLocalize.no_data_available).css({"font-weight":"bold","text-align":"center",padding:"5px"}).appendTo(document.createElement("tr")).appendTo(g);a(".wpProQuiz_delete").click(function(){if(confirm(wpProQuizLocalize.confirm_delete_entry)){var b=Array(a(this).closest("tr").find('input[name="checkedData[]"]').val());
c.loadData({a:"delete",toplistIds:b})}return!1});a(".wpProQuiz_edit").click(function(){var b=a(this).closest("tr");b.find(".row-actions").hide();b.find(".inline-edit").show();b.find(".wpProQuiz_username, .wpProQuiz_email").hide();b.find(".inline_editUsername, .inline_editEmail").show();return!1});a(".inline_editSave").click(function(){var b=a(this).closest("tr"),d=b.find(".inline_editUsername").val(),g=b.find(".inline_editEmail").val();if(c.isEmpty(d)||c.isEmpty(g))return alert(wpProQuizLocalize.not_all_fields_completed),
!1;c.loadData({a:"edit",toplistId:b.find('input[name="checkedData[]"]').val(),name:d,email:g});return!1});a(".inline_editCancel").click(function(){var b=a(this).closest("tr");b.find(".row-actions").show();b.find(".inline-edit").hide();b.find(".wpProQuiz_username, .wpProQuiz_email").show();b.find(".inline_editUsername, .inline_editEmail").hide();b.find(".inline_editUsername").val(b.find(".wpProQuiz_username").text());b.find(".inline_editEmail").val(b.find(".wpProQuiz_email").text());return!1})},checkNav:function(){var a=
d.val();1==a?e.hide():e.show();a==d.children().length?c.hide():c.show()},isEmpty:function(b){b=a.trim(b);return!b||0===b.length}};b.change(function(){i.loadData()});h.change(function(){i.loadData({nav:1})});d.change(function(){i.checkNav();i.loadData()});e.click(function(){d.val(Number(d.val())-1);i.checkNav();i.loadData()});c.click(function(){d.val(Number(d.val())+1);i.checkNav();i.loadData()});a("#wpProQuiz_deleteAll").click(function(){i.loadData({a:"deleteAll"})});a("#wpProQuiz_action").click(function(){var b=
a("#wpProQuiz_actionName").val();if("0"!=b){var c=a('input[name="checkedData[]"]:checked').map(function(){return a(this).val()}).get();i.loadData({a:b,toplistIds:c})}});a("#wpProQuiz_checkedAll").change(function(){this.checked?a('input[name="checkedData[]"]').attr("checked","checked"):a('input[name="checkedData[]"]').removeAttr("checked","checked")});i.loadData({nav:1})};a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_preview();a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_quizOverall();
a(".wpProQuiz_quizEdit").length&&a(".wpProQuiz_quizEdit").wpProQuiz_quizEdit();a(".wpProQuiz_questionOverall").length&&a(".wpProQuiz_questionOverall").wpProQuiz_questionOverall();a(".wpProQuiz_toplist").length&&a(".wpProQuiz_toplist").wpProQuiz_toplist();(function(){var b=this,b={displayChecked:function(a,b,d,e){a=d?!a.checked:a.checked;e?a?b.attr("disabled","disabled"):b.removeAttr("disabled"):a?b.show():b.hide()},isEmpty:function(b){b=a.trim(b);return!b||0===b.length},isNumber:function(c){c=a.trim(c);
return!b.isEmpty(c)&&!isNaN(c)},getMceContent:function(b){var d=tinymce.editors[b];return void 0!=d&&!d.isHidden()?d.getContent():a("#"+b).val()},ajaxPost:function(b,d,e){a.post(ajaxurl,{action:"wp_pro_quiz_admin_ajax",func:b,data:d},e,"json")}},h=function(){var c={categoryDelete:function(c){b.ajaxPost("categoryDelete",{categoryId:c},function(b){b.err||(a('select[name="category"] option[value="'+c+'"]').remove(),a('select[name="category"]').change())})},categoryEdit:function(c,d){var e={categoryId:c,
categoryName:a.trim(d)};b.isEmpty(d)?alert(wpProQuizLocalize.category_no_name):b.ajaxPost("categoryEdit",e,function(b){b.err||(a('select[name="category"] option[value="'+c+'"]').text(e.categoryName),a('select[name="category"]').change())})},changeTimeFormat:function(b,c){"0"!=c.val()&&a('input[name="'+b+'"]').val(c.val())}};a('select[name="category"]').change(function(){a('input[name="categoryEditText"]').val(a(this).find(":selected").text())}).change();a('input[name="categoryDelete"]').click(function(){var b=
a('select[name="category"] option:selected').val();c.categoryDelete(b)});a('input[name="categoryEdit"]').click(function(){var b=a('select[name="category"] option:selected').val(),d=a('input[name="categoryEditText"]').val();c.categoryEdit(b,d)});a("#statistic_time_format_select").change(function(){c.changeTimeFormat("statisticTimeFormat",a(this))});a(document).bind("changeTab",function(b){a("#problemInfo").hide("fast");switch(b.tabId){case "#problemContent":a("#problemInfo").show("fast")}});a('input[name="email[html]"]').change(function(){if(void 0==
switchEditors)return!1;this.checked?switchEditors.go("adminEmailEditor","tmce"):switchEditors.go("adminEmailEditor","html")}).change();a('input[name="userEmail[html]"]').change(function(){if(void 0==switchEditors)return!1;this.checked?switchEditors.go("userEmailEditor","tmce"):switchEditors.go("userEmailEditor","html")}).change()},d=function(){var c=this,d=a.noop(),e=a(".answer_felder > div"),f=a('input[name="answerPointsActivated"]'),i=a('input[name="points"]'),c={generateArrayIndex:function(){var b=
a('input[name="answerType"]:checked').val(),b="single"==b||"multiple"==b?"classic_answer":b;a(".answerList").each(function(){var c=a(this).parent().attr("class");a(this).children().each(function(d){a(this).find('[name^="answerData"]').each(function(){var a=this.name,e=a.search(/\](\[\w+\])+$/),g=b==c?d:"none";0<e&&(this.name="answerData["+g+a.substring(e,a.length))})})})},globalValidate:function(){if(b.isEmpty(b.getMceContent("question")))return alert(wpProQuizLocalize.no_question_msg),!1;if(f.is(":checked")){if("free_answer"==
a('input[name="answerType"]:checked').val())return alert(wpProQuizLocalize.dif_points),!1}else{var c=i.val();if(!b.isNumber(c)||1>c)return alert(wpProQuizLocalize.no_nummber_points),!1}return!1===d()?!1:!0},answerRemove:function(){var b=a(this).parent();if(2>b.parent().children().length)return!1;b.remove();return!1},addCategory:function(){var c=a.trim(a('input[name="categoryAdd"]').val());b.isEmpty(c)||b.ajaxPost("categoryAdd",{categoryName:c},function(b){b.err?a("#categoryMsgBox").text(b.err).show("fast").delay(2E3).hide("fast"):
(b=a(document.createElement("option")).val(b.categoryId).text(b.categoryName).attr("selected","selected"),a('select[name="category"]').append(b).change())})},addMediaClick:function(){if("function"!=typeof tb_show)return!1;var b=a(this).closest("li"),c=b.find('input[name="answerData[][html]"]:eq(0)'),d=b.find(".wpProQuiz_text:eq(0)");window.org_send_to_editor=window.send_to_editor;var e=tb_remove;window.send_to_editor=function(b){b=a("img",b)[0].outerHTML;d.val(d.val()+b);c.attr("checked",!0);tb_remove();
window.send_to_editor=window.org_send_to_editor};window.tb_remove=function(){window.send_to_editor=window.org_send_to_editor;tb_remove=e;tb_remove()};tb_show("","media-upload.php?type=image&TB_iframe=true")}},h={classic_answer:function(){var c=0,d=0,e=0;a(".classic_answer .answerList").children().each(function(){var g=a(this);b.isEmpty(g.find('textarea[name="answerData[][answer]"]').val())||(c++,g.find('input[name="answerData[][correct]"]:checked').length&&d++,g=g.find('input[name="answerData[][points]"]').val(),
b.isNumber(g)&&0<=g&&e++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):!d?(alert(wpProQuizLocalize.no_correct_msg),!1):e!=c&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0},free_answer:function(){return b.isEmpty(a('.free_answer textarea[name="answerData[][answer]"]').val())?(alert(wpProQuizLocalize.no_answer_msg),!1):!0},cloze_answer:function(){return b.isEmpty(b.getMceContent("cloze"))?(alert(wpProQuizLocalize.no_answer_msg),!1):!0},sort_answer:function(){var c=
0,d=0;a(".sort_answer .answerList").children().each(function(){var e=a(this);b.isEmpty(e.find('textarea[name="answerData[][answer]"]').val())||(c++,e=e.find('input[name="answerData[][points]"]').val(),b.isNumber(e)&&0<=e&&d++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):d!=c&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0},matrix_sort_answer:function(){var c=0,d=0,e=!0,g=0;a(".matrix_sort_answer .answerList").children().each(function(){var f=a(this),h=f.find('input[name="answerData[][points]"]').val();
b.isEmpty(f.find('textarea[name="answerData[][answer]"]').val())?b.isEmpty(f.find('textarea[name="answerData[][sort_string]"]').val())||(g++,b.isNumber(h)&&0<=h&&d++):(c++,g++,b.isEmpty(f.find('textarea[name="answerData[][sort_string]"]').val())&&(e=!1),b.isNumber(h)&&0<=h&&d++)});return!c?(alert(wpProQuizLocalize.no_answer_msg),!1):!e?(alert(wpProQuizLocalize.no_sort_element_criterion),!1):d!=g&&f.is(":checked")?(alert(wpProQuizLocalize.no_nummber_points_new),!1):!0},assessment_answer:function(){return b.isEmpty(b.getMceContent("assessment"))?
(alert(wpProQuizLocalize.no_answer_msg),!1):!0}};e.hide();a("#wpProQuiz_tip").change(function(){b.displayChecked(this,a("#wpProQuiz_tipBox"))}).change();a("#wpProQuiz_correctSameText").change(function(){b.displayChecked(this,a("#wpProQuiz_incorrectMassageBox"),!0)}).change();a('input[name="answerType"]').click(function(){e.hide();var b=this.value;if("single"==b||"multiple"==b){var c="single"==b?"radio":"checkbox",b="classic_answer";a(".wpProQuiz_classCorrect").each(function(){a("<input type="+c+" />").attr({name:this.name,
value:this.value,checked:this.checked}).addClass("wpProQuiz_classCorrect wpProQuiz_checkbox").insertBefore(this)}).remove()}d=void 0!=h[b]?h[b]:a.noop();a("."+b).show()});a('input[name="answerType"]:checked').click();a(".deleteAnswer").click(c.answerRemove);a(".addAnswer").click(function(){var b=a(this).siblings("ul"),d=b.find("li:eq(0)").clone();d.find(".wpProQuiz_checkbox").removeAttr("checked");d.find(".wpProQuiz_text").val("");d.find(".wpProQuiz_points").val(1);d.find(".deleteAnswer").click(c.answerRemove);
d.find(".addMedia").click(c.addMediaClick);d.appendTo(b);return!1});a(".sort_answer ul, .classic_answer ul, .matrix_sort_answer ul").sortable({handle:".wpProQuiz_move"});a("#saveQuestion").click(function(){if(!c.globalValidate())return!1;c.generateArrayIndex();return!0});a(f).change(function(){b.displayChecked(this,a(".wpProQuiz_answerPoints"));b.displayChecked(this,a("#wpProQuiz_showPointsBox"));b.displayChecked(this,i,!1,!0)}).change();a('select[name="category"]').change(function(){var b=a(this),
c=a("#categoryAddBox").hide();"-1"==b.val()&&c.show()}).change();a("#categoryAddBtn").click(function(){c.addCategory()});a(".addMedia").click(c.addMediaClick)},f=function(){var c=this,d=a("#quizId").val(),e="users",f=a("#wpProQuiz_currentPage"),h=a("#wpProQuiz_pageLeft"),j=a("#wpProQuiz_pageRight"),k=a("#testSelect"),c={loadStatistic:function(a){b.ajaxPost("statisticLoad",{userId:a},function(){})},loadUsersStatistic:function(){var e={userId:a("#userSelect").val(),quizId:d,testId:a("#testSelect").val()};
c.toggleLoadBox(!1);b.ajaxPost("statisticLoad",e,function(b){a.each(b.question,function(){var b=a("#wpProQuiz_tr_"+this.questionId);c.setStatisticData(b,this)});a.each(b.category,function(b,d){var e=a("#wpProQuiz_ctr_"+b);c.setStatisticData(e,d)});a("#testSelect option:gt(0)").remove();var d=a("#testSelect");a.each(b.tests,function(){var c=a(document.createElement("option"));c.val(this.id);c.text(this.date);b.testId==this.id&&c.attr("selected",!0);d.append(c)});c.toggleLoadBox(!0)})},setStatisticData:function(a,
b){a.find(".wpProQuiz_cCorrect").text(b.correct);a.find(".wpProQuiz_cIncorrect").text(b.incorrect);a.find(".wpProQuiz_cTip").text(b.hint);a.find(".wpProQuiz_cPoints").text(b.points);a.find(".wpProQuiz_cResult").text(b.result);a.find(".wpProQuiz_cTime").text(b.questionTime)},toggleLoadBox:function(b){var c=a("#wpProQuiz_loadData"),d=a("#wpProQuiz_content");b?(c.hide(),d.show()):(d.hide(),c.show())},reset:function(e){var f=a("#userSelect").val();confirm(wpProQuizLocalize.reset_statistics_msg)&&(e={quizId:d,
userId:f,testId:k.val(),type:e},c.toggleLoadBox(!1),b.ajaxPost("statisticReset",e,function(){c.loadUsersStatistic()}))},loadStatisticOverview:function(e){e={quizId:d,pageLimit:a("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(a("#wpProQuiz_onlyCompleted").is(":checked")),page:f.val(),nav:Number(e)};c.toggleLoadBox(!1);b.ajaxPost("statisticLoadOverview",e,function(b){var d=a("#wpProQuiz_statistics_overview_data"),e=d.children(),f=e.first().clone();e.slice(1).remove();a.each(b.items,function(){var b=
f.clone();c.setStatisticData(b,this);b.find("a").text(this.userName).data("userId",this.userId).click(function(){a("#userSelect").val(a(this).data("userId"));a("#wpProQuiz_typeUser").click();return!1});b.show().appendTo(d)});f.remove();c.toggleLoadBox(!0);void 0!=b.page&&c.handleNav(b.page)})},handleNav:function(b){for(var d=a("#wpProQuiz_currentPage").empty(),e=1;e<=b;e++)a(document.createElement("option")).val(e).text(e).appendTo(d);c.checkNavBar()},checkNavBar:function(){var a=f.val();1==a?h.hide():
h.show();a==f.children().length?j.hide():j.show()},refresh:function(){"users"==e?c.loadUsersStatistic():c.loadStatisticOverview(!0)}};a("#userSelect, #testSelect").change(function(){c.loadUsersStatistic()});a(".wpProQuiz_update").click(function(){c.refresh()});a("#wpProQuiz_reset").click(function(){c.reset(0)});a("#wpProQuiz_resetUser").click(function(){c.reset(1)});a(".wpProQuiz_resetComplete").click(function(){c.reset(2)});a(".wpProQuiz_tab").click(function(){var b=a(this);a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");
b.removeClass("button-secondary").addClass("button-primary");a(".wpProQuiz_tabContent").hide();"wpProQuiz_typeUser"==b.attr("id")?(e="users",a("#wpProQuiz_tabUsers").show(),c.loadUsersStatistic()):(e="overview",a("#wpProQuiz_tabOverview").show(),c.loadStatisticOverview(!0));return!1});a("#wpProQuiz_onlyCompleted").change(function(){f.val(1);c.loadStatisticOverview(!0)});a("#wpProQuiz_pageLimit").change(function(){f.val(1);c.loadStatisticOverview(!0)});h.click(function(){f.val(Number(f.val())-1);c.loadStatisticOverview(!1);
c.checkNavBar()});j.click(function(){f.val(Number(f.val())+1);c.loadStatisticOverview(!1);c.checkNavBar()});f.change(function(){c.loadStatisticOverview(!1);c.checkNavBar()});c.loadUsersStatistic()};a(".wpProQuiz_tab_wrapper a").click(function(){var b=a(this),d=b.data("tab"),e=b.siblings(".button-primary").removeClass("button-primary").addClass("button-secondary");b.removeClass("button-secondary").addClass("button-primary");a(e.data("tab")).hide("fast");a(d).show("fast");a(document).trigger({type:"changeTab",
tabId:d});return!1});var e=a.noop;a(".wpProQuiz_questionEdit").length?e=d:a(".wpProQuiz_globalSettings").length?e=h:a(".wpProQuiz_statistics").length&&(e=f);e();a(".wpProQuiz_demoImgBox a").mouseover(function(b){var d=a(this),e=a(document).width(),d=d.siblings().outerWidth(!0);b.pageX+d>e&&(b=e-(b.pageX+d+30),a(this).next().css("left",b+"px"));a(this).next().show()}).mouseout(function(){a(this).next().hide()}).click(function(){return!1})})()});
